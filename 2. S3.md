
# S3 - Simple Storage Service

Amazon **S3** is AWS’s highly scalable, durable, and secure **object storage service**. It is used extensively in **data engineering pipelines**, data lakes, backups, and serverless architectures.

---

## 2.1 Understanding S3 Fundamentals

### What is S3?

- S3 stores **objects**, not files. Each object contains:
    - **Data** → The actual content (file, image, CSV, etc.)
    - **Metadata** → Key-value pairs describing the object
    - **Key** → Unique identifier for the object (like a path)
    - **Version ID** → Optional, if versioning is enabled
- **Key Features:**
    
    - **Unlimited storage** — S3 scales automatically
        
    - **11 nines durability** — 99.999999999%
        
    - **99.99% availability**
        
    - **Security controls** via IAM, bucket policies, ACLs
        
    - **Integration** with Lambda, CloudWatch, Athena, Glue, and other AWS services
        

### S3 Architecture Concepts

|Concept|Explanation|
|---|---|
|**Bucket**|Top-level container for objects; names must be globally unique|
|**Object**|Individual data item in a bucket|
|**Key**|Unique name/path of object within a bucket|
|**Region**|Physical location of bucket data (e.g., `us-east-1`)|
|**Prefix**|Virtual folder inside a bucket (`raw/sample/`)|
|**Versioning**|Tracks multiple versions of an object|
|**Storage Classes**|Standard, Standard-IA, OneZone-IA, Intelligent-Tiering, Glacier, Deep Archive|
|**ACLs**|Access control for individual objects|
|**Bucket Policies**|JSON rules to allow/deny access to a bucket or objects|
|**Lifecycle Rules**|Automate transitioning objects between storage classes or deletion|

---

## 2.2 Bucket Basics

### Creating a Bucket

```bash
aws s3api create-bucket \
  --bucket developers-test-bucket1 \
  --region ap-south-1 \
  --create-bucket-configuration LocationConstraint=ap-south-1
```

- Bucket names must be **globally unique**
    
- Region matters: affects **latency**, **pricing**, and **data residency**
    

### Listing Buckets

```bash
aws s3 ls
```

### Bucket Properties to Know

- **Versioning** → Enabled/Disabled
    
- **Encryption** → SSE-S3, SSE-KMS, SSE-C
    
- **Logging** → Access logs can be stored in another bucket
    
- **Notifications** → Trigger Lambda, SQS, or SNS on object events
    
- **Tags** → Key-value pairs for billing and management
    

---

## 2.3 Objects and Keys

### Uploading Objects

```bash
aws s3api put-object \
  --bucket developers-test-bucket1 \
  --key raw/sample/.zshrc \
  --body .zshrc
```

- `--key` acts like a **file path**. Even if you create “folders” (`raw/`, `gold/`), S3 stores **flat key-value objects**.
    
- Upload **directories recursively** with:
    

```bash
aws s3 cp local_dir s3://bucket_name/prefix/ --recursive
```

### Downloading Objects

```bash
aws s3api get-object \
  --bucket developers-test-bucket1 \
  --key intermediate/git.txt \
  git.txt
```

### Deleting Objects

```bash
aws s3api delete-object --bucket developers-test-bucket1 --key intermediate/git.txt
```

### Listing Objects

```bash
aws s3 ls developers-test-bucket1/raw/
aws s3 ls developers-test-bucket1/intermediate/
```

---

## 2.4 S3 Storage Classes

|Storage Class|Use Case|Cost|Availability|
|---|---|---|---|
|**Standard**|Frequent access, general-purpose|High|99.99%|
|**Standard-IA**|Infrequent access|Lower|99.9%|
|**OneZone-IA**|Infrequent access, single AZ|Lowest|99.5%|
|**Intelligent-Tiering**|Unknown patterns, auto-cost optimization|Medium|99.9%|
|**Glacier**|Long-term archive, retrieval in minutes to hours|Very low|99.99%|
|**Glacier Deep Archive**|Deep archive, retrieval can take hours|Cheapest|99.99%|

**Tip:** For a data lake, typically **raw → intermediate → gold** uses **Standard → Standard-IA → Glacier** lifecycle.

---

## 2.5 Versioning

- **Enable Versioning**
    

```bash
aws s3api put-bucket-versioning \
  --bucket developers-test-bucket1 \
  --versioning-configuration Status=Enabled
```

- Protects against **accidental deletes or overwrites**
    
- **List versions**
    

```bash
aws s3api list-object-versions \
  --bucket developers-test-bucket1 \
  --prefix raw/sample/.zshrc
```

- Versioning creates **unique version IDs** for each object update.
    

---

## 2.6 Lifecycle Policies

Lifecycle policies allow **automatic transition or deletion of objects** based on age or other conditions.

### Example Policy: Move Raw Data to Glacier after 30 Days

`lifecycle_config.json`:

```json
{
  "Rules": [
    {
      "ID": "Archive raw data after 30 days",
      "Prefix": "raw/",
      "Status": "Enabled",
      "Transitions": [
        {
          "Days": 30,
          "StorageClass": "GLACIER"
        }
      ],
      "NoncurrentVersionTransitions": [
        {
          "NoncurrentDays": 30,
          "StorageClass": "GLACIER"
        }
      ]
    }
  ]
}
```

### Apply Lifecycle Configuration

```bash
aws s3api put-bucket-lifecycle-configuration \
  --bucket developers-test-bucket1 \
  --lifecycle-configuration file://lifecycle_config.json
```

### Verify Lifecycle

```bash
aws s3api get-bucket-lifecycle-configuration --bucket developers-test-bucket1
```

---

## 2.7 Bucket Notifications and Lambda Integration

S3 can trigger **Lambda**, **SQS**, or **SNS** events.

### Step 1: Grant Lambda Permission

```bash
aws lambda add-permission \
  --function-name s3-upload-logger \
  --principal s3.amazonaws.com \
  --statement-id s3invoke \
  --action "lambda:InvokeFunction" \
  --source-arn arn:aws:s3:::developers-test-bucket1
```

### Step 2: Configure S3 to Trigger Lambda

```bash
aws s3api put-bucket-notification-configuration \
  --bucket developers-test-bucket1 \
  --notification-configuration '{
      "LambdaFunctionConfigurations": [
          {
              "LambdaFunctionArn": "arn:aws:lambda:us-east-1:773754453720:function:s3-upload-logger",
              "Events": ["s3:ObjectCreated:*"]
          }
      ]
  }'
```

**Common Events:**

- `s3:ObjectCreated:*` → All object creation
    
- `s3:ObjectRemoved:*` → Deletion events
    
- `s3:ObjectRestore:*` → Glacier restore events
    

---

## 2.8 Data Organization Patterns (Medallion Architecture)

|Layer|S3 Prefix|Purpose|
|---|---|---|
|**Raw**|`raw/`|Store unprocessed source data|
|**Intermediate**|`intermediate/`|Cleaned/transformed data|
|**Gold**|`gold/`|Final curated data for analytics|

**Example Commands:**

```bash
aws s3api put-object --bucket developers-test-bucket1 --key raw/sample/data.csv --body data.csv
aws s3api put-object --bucket developers-test-bucket1 --key intermediate/data_cleaned.csv --body data_cleaned.csv
aws s3api put-object --bucket developers-test-bucket1 --key gold/data_analytics.csv --body data_analytics.csv
```

---

## 2.9 S3 Security & Access Control

### IAM Integration

- Grant bucket/object access via **IAM users/groups**:
    

```bash
aws iam attach-user-policy --user-name dev-asad \
  --policy-arn arn:aws:iam::123456789012:policy/S3AccessPolicy
```

### Bucket Policies

- JSON rules to allow or deny access to objects.
    

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": "*",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::developers-test-bucket1/*"
    }
  ]
}
```

### Encryption

- **SSE-S3** → AWS-managed keys
    
- **SSE-KMS** → Customer-managed KMS keys
    
- **SSE-C** → Customer-provided keys
    

---

## 2.10 S3 CLI Quick Reference

| Action                    | Command Example                                                                                                      |
| ------------------------- | -------------------------------------------------------------------------------------------------------------------- |
| List buckets              | `aws s3 ls`                                                                                                          |
| List objects              | `aws s3 ls developers-test-bucket1/raw/`                                                                             |
| Upload file               | `aws s3api put-object --bucket my-bucket --key folder/file.txt --body file.txt`                                      |
| Download file             | `aws s3api get-object --bucket my-bucket --key folder/file.txt file.txt`                                             |
| Delete file               | `aws s3api delete-object --bucket my-bucket --key folder/file.txt`                                                   |
| Enable versioning         | `aws s3api put-bucket-versioning --bucket my-bucket --versioning-configuration Status=Enabled`                       |
| Set lifecycle             | `aws s3api put-bucket-lifecycle-configuration --bucket my-bucket --lifecycle-configuration file://config.json`       |
| Configure Lambda triggers | `aws s3api put-bucket-notification-configuration --bucket my-bucket --notification-configuration file://config.json` |


## 2.11 Best Practices

- Use **prefixes/folders** to organize data
    
- **Enable versioning** for critical data
    
- Implement **lifecycle policies** for cost optimization
    
- Use **bucket policies and IAM roles** for fine-grained access
    
- **Encrypt sensitive data**
    
- **Monitor S3 events** for automation and alerting
    
- For **data pipelines**, follow **raw → intermediate → gold** approach
    
