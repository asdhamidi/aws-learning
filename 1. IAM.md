# IAM - Identity and Access Management

AWS **IAM** is the backbone of secure access control in AWS. It lets you **control who can do what** across your AWS environment.

---

## 1.1 Understanding IAM Fundamentals

### What is IAM?

IAM (Identity and Access Management) is AWS’s service for securely controlling access to your cloud resources.  
Think of IAM as the **security guard** of your AWS account:

- **Authentication** → Who is this?
- **Authorization** → What can this identity do?
### Core IAM Components

|Component|Purpose|Real-World Analogy|
|---|---|---|
|**User**|Individual human or application|Employee with a unique ID card|
|**Group**|Collection of users with similar permissions|Department (Engineering, Marketing)|
|**Policy**|JSON document defining permissions|Rulebook specifying access rules|
|**Role**|Temporary permissions for specific tasks or services|Visitor pass with limited, time-bound access|

---

## 1.2 Initial AWS CLI Setup

### Configure Your Credentials

```bash
aws configure
```

**Prompts:**

- **AWS Access Key ID** → Username equivalent for CLI/programmatic access
    
- **AWS Secret Access Key** → Password equivalent
    
- **Default Region** → AWS data center (e.g., `us-east-1`)
    
- **Output Format** → `json` (default), `text`, `table`, `yaml`
    

**Tip:** Avoid using root credentials for everyday tasks; create a dedicated IAM user instead.

### CLI Command Structure

```bash
aws <service> <operation> [parameters] [options]
```

**Examples:**

```bash
aws iam list-users
aws s3 ls
aws ec2 describe-instances
```

### Managing Multiple Profiles

```bash
# Configure multiple identities
aws configure --profile root
aws configure --profile asad

# Use a specific profile
aws s3 ls --profile asad
aws iam list-users --profile root
```

**Quick Switching via Environment Variables**

```bash
export AWS_PROFILE=asad   # temporarily switch
aws s3 ls

# Add aliases in ~/.bashrc or ~/.zshrc
alias aws-root='export AWS_PROFILE=root'
alias aws-asad='export AWS_PROFILE=asad'
```

Switch with a single command:

```bash
aws-asad
aws s3 ls
aws-root
```

### AWS SSO Integration

```bash
aws sso login --profile my-profile
aws sso login --profile asad
```

---

## 1.3 IAM Users

### Why Separate Users?

- **Security:** Avoid root for daily tasks
    
- **Auditability:** Track actions per user
    
- **Least Privilege:** Grant only necessary permissions
    

### Commands

```bash
# List all users
aws iam list-users

# Create a user
aws iam create-user --user-name dev-asad

# Get user info
aws iam get-user --user-name asad

# Delete user
aws iam delete-user --user-name dev-asad
```

**Tips:**

- Always assign permissions through **groups**, not individual users.
    
- Use `--query` for filtered outputs and `--output table` for readability.
    

---

## 1.4 Groups

Groups make **permission management scalable**.

### Commands

```bash
# Create a group
aws iam create-group --group-name developers

# Add a user to a group
aws iam add-user-to-group --user-name dev-asad --group-name developers

# List group members
aws iam get-group --group-name developers

# Remove user
aws iam remove-user-from-group --user-name dev-asad --group-name developers

# Delete group
aws iam delete-group --group-name developers
```

**Best Practice:** Assign policies to groups, not individual users.

---

## 1.5 Policies

### What are Policies?

Policies are **JSON documents** defining:

- **Actions** → what API operations are allowed
    
- **Resources** → which resources can be accessed
    
- **Conditions** → optional restrictions (IP, MFA, time, etc.)
    

### Example Policy

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AllowS3Access",
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject",
        "s3:DeleteObject"
      ],
      "Resource": "arn:aws:s3:::developers-test-bucket1/*",
      "Condition": {
        "IpAddress": {"aws:SourceIp": "192.0.2.0/24"}
      }
    }
  ]
}
```

### Policy Commands

```bash
# Create policy from JSON file
aws iam create-policy \
  --policy-name testS3BucketAccessPolicy \
  --policy-document file://s3-bucket-access.json

# List all policies
aws iam list-policies

# Get policy info
aws iam get-policy --policy-arn arn:aws:iam::aws:policy/AdministratorAccess

# Delete policy
aws iam delete-policy --policy-arn arn:aws:iam::123456789012:policy/testS3BucketAccessPolicy
```

### Policy Versioning

```bash
# Create new version and set default
aws iam create-policy-version \
  --policy-arn arn:aws:iam::123456789012:policy/testS3BucketAccessPolicy \
  --policy-document file://s3-bucket-access.json \
  --set-as-default

# Delete old version
aws iam delete-policy-version \
  --policy-arn arn:aws:iam::123456789012:policy/testS3BucketAccessPolicy \
  --version-id v1
```

---

## 1.6 Attaching Policies

```bash
# Attach to group
aws iam attach-group-policy \
  --policy-arn arn:aws:iam::aws:policy/AdministratorAccess \
  --group-name developers

# Attach directly to user
aws iam attach-user-policy \
  --policy-arn arn:aws:iam::123456789012:policy/testS3BucketAccessPolicy \
  --user-name dev-asad

# Detach policy
aws iam detach-group-policy \
  --group-name developers \
  --policy-arn arn:aws:iam::aws:policy/AdministratorAccess

# List attached policies
aws iam list-attached-group-policies --group-name developers
aws iam list-attached-user-policies --user-name dev-asad
```

---

## 1.7 S3 Operations With IAM

### Examples

```bash
# Create bucket
aws s3api create-bucket --bucket developers-test-bucket1

# List buckets
aws s3api list-buckets

# Upload object
aws s3api put-object \
  --bucket developers-test-bucket1 \
  --key mongoDocs/activities.json \
  --body blog_database1.activities.json

# List objects
aws s3api list-objects --bucket developers-test-bucket1

# Delete object
aws s3api delete-object --bucket developers-test-bucket1 --key mongoDocs/activities.json
```

---

## 1.8 Getting ARNs via CLI

Instead of console lookups:

```bash
# User ARN
aws iam get-user --user-name asad --query 'User.Arn' --output text

# Group ARN
aws iam get-group --group-name developers --query 'Group.Arn' --output text

# Policy ARN
aws iam list-policies --query 'Policies[?PolicyName==`testS3BucketAccessPolicy`].Arn' --output text

# Role ARN
aws iam get-role --role-name MyRole --query 'Role.Arn' --output text

# S3 bucket ARNs are predictable:
arn:aws:s3:::developers-test-bucket1
arn:aws:s3:::developers-test-bucket1/*
```

---

## 1.9 Troubleshooting Common Errors

|Error|Cause|Fix|
|---|---|---|
|AccessDenied|Missing permission|Check attached policies|
|NoSuchEntity|Resource not found|Verify name/ARN|
|MalformedPolicyDocument|Invalid JSON|Validate JSON file|
|InvalidClientTokenId|Invalid credentials|Run `aws configure` or check profile|

**Flow for permission troubleshooting:**

1. Check user → groups → policies → actions → resource → conditions.
    

---

## 1.10 Quick Reference

### Users & Groups

```bash
aws iam list-users
aws iam create-user --user-name dev-asad
aws iam create-group --group-name developers
aws iam add-user-to-group --user-name dev-asad --group-name developers
```

### Policies

```bash
aws iam create-policy --policy-name MyPolicy --policy-document file://policy.json
aws iam attach-group-policy --group-name developers --policy-arn arn:aws:iam::...
aws iam list-policies
```

### S3

```bash
aws s3api create-bucket --bucket my-bucket
aws s3api put-object --bucket my-bucket --key path/file.json --body local-file.json
aws s3api list-buckets
```

### Profile Switching

```bash
export AWS_PROFILE=asad
aws s3 ls
```
