# IAM — Identity and Access Management 

AWS **Identity and Access Management (IAM)** enables fine-grained control over who can access AWS resources and what operations they can perform. It is **central to security, least privilege, and auditability** in AWS.

---

## 1.1 IAM Core Concepts Recap

|IAM Concept|Description|Example Use Case|
|---|---|---|
|**User**|Represents a person or application needing long-term access.|Developer account for CLI or SDK use.|
|**Group**|Logical collection of users with shared permissions.|All developers have read-only access to S3.|
|**Policy**|JSON document defining permissions: what actions are allowed or denied on which resources.|Allow `s3:GetObject` on specific bucket.|
|**Role**|Identity with a set of permissions **assumed** temporarily by AWS services or users.|Allow Lambda to access DynamoDB.|
|**Instance Profile**|Container for a role, attachable to compute services like EC2.|(Used implicitly when roles are applied to EC2.)|

IAM operates under **least privilege** — grant only what’s necessary, nothing more.

---

## 1.2 IAM Listing and Discovery Commands

IAM provides commands to view users, policies, and roles in your account.

```bash
# List all IAM users
aws iam list-users
```

**Concept:** Lists all users created under your AWS account.  
Each user entry includes:

- `UserName`
    
- `UserId`
    
- `Arn`
    
- `CreateDate`
    

This is useful for **auditing active users** and verifying user creation after automation scripts.

```bash
# List all IAM policies available in the account
aws iam list-policies
```

**Concept:** Fetches both AWS-managed and customer-managed policies.  
You can filter or search through the output to find existing permissions templates:

```bash
aws iam list-policies | grep "AmazonS3ReadOnlyAccess"
```

> AWS-managed policies are globally available, while customer-managed ones reside in your account namespace (`arn:aws:iam::<account-id>:policy/...`).

---

## 1.3 Creating IAM Users

```bash
aws iam create-user --user-name ec2-user
```

**Concept:** Creates a new IAM identity (user) with no permissions by default.  
Users must later be assigned **policies**, **groups**, or **access keys** to perform actions.

To verify:

```bash
aws iam get-user --user-name ec2-user
```

**Example Output:**

```json
{
  "User": {
    "Path": "/",
    "UserName": "ec2-user",
    "UserId": "AIDAEXAMPLEID",
    "Arn": "arn:aws:iam::123456789012:user/ec2-user",
    "CreateDate": "2025-11-10T12:35:21Z"
  }
}
```

---

## 1.4 Attaching Managed Policies to a User

```bash
aws iam attach-user-policy \
  --policy-arn arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess \
  --user-name ec2-user
```

**Concept:** Grants permissions defined in the specified policy to the user.  
Policies can be **AWS-managed**, **customer-managed**, or **inline**.

**Verify attachments:**

```bash
aws iam list-attached-user-policies --user-name ec2-user
```

**Detach when no longer needed:**

```bash
aws iam detach-user-policy \
  --user-name ec2-user \
  --policy-arn arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess
```

---

## 1.5 IAM Policy JSON Documents

Policies are JSON-based and follow the **AWS Policy Language**.

### Policy Structure

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": ["s3:GetObject"],
      "Resource": ["arn:aws:s3:::my-bucket/*"]
    }
  ]
}
```

### Creating a Policy

```bash
touch s3_access.json
nano s3_access.json
```

Then define permissions as shown above.

```bash
aws iam create-policy \
  --policy-name S3ReadOnlyCustom \
  --policy-document file://s3_access.json
```

**Concept:**

- `--policy-document` points to a local JSON file.
    
- The resulting policy is **customer-managed**, and can be reused across users, groups, or roles.
    

To confirm:

```bash
aws iam list-policies --scope Local --query 'Policies[?PolicyName==`S3ReadOnlyCustom`].Arn'
```

---

## 1.6 IAM Roles

Roles provide **temporary, assumable permissions** for entities that need to act on behalf of others — users, services, or applications.

Before creating a role, define a **trust policy** (who can assume the role):

```bash
cat > trust-policy.json <<EOF
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": { "Service": "ec2.amazonaws.com" },
      "Action": "sts:AssumeRole"
    }
  ]
}
EOF
```

This trust relationship can instead reference other users, services, or even AWS accounts (for cross-account roles).

### Create Role

```bash
aws iam create-role \
  --role-name S3AccessRole \
  --assume-role-policy-document file://trust-policy.json
```

**Concept:**  
The role is now created with _no permissions_ — only the right to be assumed by specific principals.

### Attach Policy to Role

```bash
aws iam attach-role-policy \
  --role-name S3AccessRole \
  --policy-arn arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess
```

**Concept:**  
Now, entities that assume this role can perform `s3:GetObject` and other read-only S3 actions.

To view attached policies:

```bash
aws iam list-attached-role-policies --role-name S3AccessRole
```

---

## 1.7 Instance Profiles (Conceptual Extension)

While originally designed for EC2, **instance profiles** are simply containers that hold IAM roles for services needing automatic role assumption.

```bash
aws iam create-instance-profile --instance-profile-name S3AccessProfile
aws iam add-role-to-instance-profile \
  --instance-profile-name S3AccessProfile \
  --role-name S3AccessRole
```

**Concept:**  
This allows the compute service to fetch temporary credentials tied to the role automatically — eliminating hardcoded access keys.

Even if not used directly, understanding instance profiles is key to grasping how **services assume roles** internally.

---

## 1.8 Putting It All Together — IAM Entity Relationships

|Entity|Created Using|Purpose|Example Command|
|---|---|---|---|
|**User**|`aws iam create-user`|Represents a human or app identity|`aws iam create-user --user-name data-analyst`|
|**Group**|`aws iam create-group`|Manages multiple users collectively|`aws iam add-user-to-group`|
|**Policy**|`aws iam create-policy`|Defines actions allowed/denied|`aws iam create-policy --policy-name ReadOnlyAccess`|
|**Role**|`aws iam create-role`|Grants temporary permissions|`aws iam create-role --assume-role-policy-document file://trust-policy.json`|
|**Instance Profile**|`aws iam create-instance-profile`|Attaches a role to a service|`aws iam add-role-to-instance-profile`|

---

## 1.9 Best Practices Recap

1. **Never use root credentials** for API or CLI operations.
    
2. **Use groups** to manage permissions across multiple users.
    
3. **Grant least privilege** — only what’s required.
    
4. **Prefer roles** over access keys when possible.
    
5. **Rotate and delete** unused credentials regularly.
    
6. **Audit access** using CloudTrail + `aws iam list-*` commands.
    

---

## 1.10 IAM Quick Reference Sheet

```bash
# List users and policies
aws iam list-users
aws iam list-policies

# Create user and attach permissions
aws iam create-user --user-name ec2-user
aws iam attach-user-policy \
  --user-name ec2-user \
  --policy-arn arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess

# Create trust policy for a role
cat > trust-policy.json <<EOF
{ "Version": "2012-10-17", "Statement": [ { "Effect": "Allow", "Principal": { "Service": "ec2.amazonaws.com" }, "Action": "sts:AssumeRole" } ] }
EOF

# Create and configure a role
aws iam create-role \
  --role-name S3AccessRole \
  --assume-role-policy-document file://trust-policy.json
aws iam attach-role-policy \
  --role-name S3AccessRole \
  --policy-arn arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess

# Instance profile (generic container for service-role binding)
aws iam create-instance-profile --instance-profile-name S3AccessProfile
aws iam add-role-to-instance-profile \
  --instance-profile-name S3AccessProfile \
  --role-name S3AccessRole
```
