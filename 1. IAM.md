Perfect! Iâ€™ve integrated your notes into **Chapter 1: IAM** in Markdown format, keeping everything organized and Obsidian-ready. Iâ€™ve also preserved your headings, examples, and tips.

---

# Chapter 1: IAM

## Basics

- **IAM (Identity and Access Management)** is used to securely control access to AWS resources.
    
- Entities in IAM:
    
    - **Users** â†’ Represent individual identities.
        
    - **Groups** â†’ Collection of users with shared permissions.
        
    - **Policies** â†’ Define access rules (JSON documents).
        
    - **Roles** â†’ Grant temporary access to AWS resources.
        

---

## AWS CLI Setup

```bash
aws configure
```

- Configure access credentials (`AWS Access Key`, `Secret Key`, `Region`, `Output format`).
    
- Can be used multiple times to switch/update profiles.
    

```bash
aws sso login --profile my-profile
aws sso login --profile asad
```

- For logging in via AWS SSO with specific profiles.
    

---

## User Management

### List all users

```bash
aws iam list-users
```

### Create a user

```bash
aws iam create-user --user-name dev-asad
```

---

## Group Management

### Create a group

```bash
aws iam create-group --group-name developers
```

### Attach policy to group

```bash
aws iam attach-group-policy \
  --policy-arn arn:aws:iam::aws:policy/AdministratorAccess \
  --group-name developers
```

### Add user to group

```bash
aws iam add-user-to-group \
  --user-name dev-asad \
  --group-name developers
```

### Detach policy from group

```bash
aws iam detach-group-policy \
  --group-name developers \
  --policy-arn arn:aws:iam::aws:policy/AdministratorAccess
```

---

## Policies

### Create a policy

- Write policy in JSON file (`s3-bucket-access.json`).
    

```bash
aws iam create-policy \
  --policy-name testS3BucketAccessPolicy \
  --policy-document file://s3-bucket-access.json
```

### Attach policy to group

```bash
aws iam attach-group-policy \
  --policy-arn arn:aws:iam::<account-id>:policy/testS3BucketAccessPolicy \
  --group-name developers
```

### Create new policy version (when updating JSON)

```bash
aws iam create-policy-version \
  --policy-arn arn:aws:iam::<account-id>:policy/testS3BucketAccessPolicy \
  --policy-document file://s3-bucket-access.json
```

---

## Common Pain Points & Fixes

### 1. Getting ARNs via CLI (instead of console)

You donâ€™t need to open the AWS Console every time. AWS CLI can fetch ARNs directly:

- **For a user**:
    

```bash
aws iam get-user --user-name asad --query 'User.Arn' --output text
```

- **For a group**:
    

```bash
aws iam get-group --group-name developers --query 'Group.Arn' --output text
```

- **For a role**:
    

```bash
aws iam get-role --role-name MyRole --query 'Role.Arn' --output text
```

- **For a policy**:
    

```bash
aws iam list-policies --query 'Policies[?PolicyName==`MyS3BucketAccessPolicy`].Arn' --output text
```

- **For an S3 bucket**:  
    S3 bucket ARNs are always of the form:
    

```
arn:aws:s3:::bucket-name
arn:aws:s3:::bucket-name/*
```

Example for `developers-test-bucket1`:

```
arn:aws:s3:::developers-test-bucket1
arn:aws:s3:::developers-test-bucket1/*
```

- ðŸ‘‰ No need to fetch; you just construct them.
    

---

### 2. Switching Between Root and IAM Users Quickly

Avoid running `aws configure` every time â€” use **named profiles**.

#### Step A. Set up multiple profiles

```bash
aws configure --profile root
aws configure --profile asad
```

#### Step B. Use `--profile` flag

```bash
aws s3 ls --profile asad
aws iam list-users --profile root
```

#### Step C. Or switch with environment variable

```bash
export AWS_PROFILE=asad
aws s3 ls    # runs as asad
export AWS_PROFILE=root
aws s3 ls    # runs as root
```

#### Step D. Pro tip for fast switching

Add aliases to `~/.bashrc` or `~/.zshrc`:

```bash
alias aws-root='export AWS_PROFILE=root'
alias aws-asad='export AWS_PROFILE=asad'
```

Now you can just type:

```bash
aws-asad
aws s3 ls
aws-root
aws s3 ls
```

---

## Observations / Learnings

1. **Users are identities**, but permissions are ideally attached to **groups**, not directly to users.
2. **Policies** are versioned â†’ every time you update, a new version is created.
3. **Detaching/attaching policies** lets you fine-tune access control without deleting resources.
4. **SSO profiles** simplify switching between environments.
5. **CLI queries** (`--query '...Arn'`) can fetch ARNs directly, reducing console dependency.
6. **Named profiles** and environment variable switching reduce friction between multiple accounts.
    

---

âœ… **Progress in IAM so far:**

- Learned to **list users**, **create groups/users**, and **attach policies**.
- Practiced **creating custom S3 policies** and attaching them to groups.
- Got hands-on experience with **policy versioning** and **profile switching**.
